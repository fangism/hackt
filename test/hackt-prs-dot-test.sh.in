#!@SH_PATH@
# "hackt-prs-dot-test.sh.in"
#	$Id: hackt-prs-dot-test.sh.in,v 1.2 2006/07/28 09:08:20 fang Exp $

# This just produces .dot files from .haco-a files.  

# $1 is the input file name WITHOUT the .in extension

# if test $# -lt 3 ; then exit 1 ; fi

bldroot=$1

DIE=0

# try to build pre-requisite first (not just .haco-a)
rm -f $bldroot.prs
@CALLMAKE@ $bldroot.prs > /dev/null 2>&1
if test -s $bldroot.prs
then
	# @ECHO@ "Running test $bldroot.hacktprsdottest."
	rm -f $bldroot.prsimexpr-O1 $bldroot.prs-dot-O1
	# don't bother building in parallel
	if ! @CALLMAKE@ $bldroot.prsimexpr-O1 > /dev/null 2>&1
	then	
		DIE=1
		# re-run for error message
		@CALLMAKE@ $bldroot.prsimexpr-O1
	fi
	if ! @CALLMAKE@ $bldroot.prs-dot-O1 > /dev/null 2>&1
	then	
		DIE=1
		# re-run for error message
		@CALLMAKE@ $bldroot.prs-dot-O1
	fi
# if prerequisite fails, then skip this test
else	
	# @ECHO@ "Skipping test $bldroot.hacktprsdottest."
	exit 77
fi
# 2>&1 | sed '/WARNING: ignoring unknown/d'

if test "$DIE" -eq 1
then	exit 1
fi

